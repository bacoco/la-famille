x-zeroclaw: &zc
  image: la-famille-runtime:latest
  build:
    context: .
    dockerfile: Dockerfile.runtime
  restart: unless-stopped
  networks: [famille-net]
  volumes:
    - ./families:/app/families

services:
  gateway:
    build:
      context: .
      dockerfile: gateway/Dockerfile
    ports: ["3000:3000"]
    restart: unless-stopped
    networks: [famille-net]
    volumes:
      - ./registry.json:/app/registry.json:ro
      - ./families:/app/families
    environment:
      GATEWAY_PORT: "3000"
      RUST_LOG: info

  maman:
    <<: *zc
    ports: ["3101:3101"]
    environment:
      ZEROCLAW_WORKSPACE: /app/families/openclaw/maman
      # Anthropic: OAuth token (sk-ant-oat01-...) or API key
      ANTHROPIC_OAUTH_TOKEN: "${ANTHROPIC_OAUTH_TOKEN:-}"
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY:-}"
      ZEROCLAW_ALLOW_PUBLIC_BIND: "true"
      RUST_LOG: info

  henry:
    <<: *zc
    ports: ["3102:3102"]
    environment:
      ZEROCLAW_WORKSPACE: /app/families/openclaw/henry
      # Z.AI Anthropic-compatible endpoint (CodeMax)
      ANTHROPIC_API_KEY: "${ZAI_API_KEY}"
      ZEROCLAW_ALLOW_PUBLIC_BIND: "true"
      RUST_LOG: info

  sage:
    <<: *zc
    ports: ["3103:3103"]
    environment:
      ZEROCLAW_WORKSPACE: /app/families/openclaw/sage
      GEMINI_API_KEY: "${GEMINI_API_KEY}"
      ZEROCLAW_ALLOW_PUBLIC_BIND: "true"
      RUST_LOG: info

  nova:
    <<: *zc
    ports: ["3104:3104"]
    environment:
      ZEROCLAW_WORKSPACE: /app/families/openclaw/nova
      # OpenAI Codex — auth-profiles.json in workspace dir (flat persisted format)
      ZEROCLAW_CODEX_REASONING_EFFORT: "high"
      ZEROCLAW_ALLOW_PUBLIC_BIND: "true"
      RUST_LOG: info

  blaise:
    <<: *zc
    ports: ["3105:3105"]
    environment:
      ZEROCLAW_WORKSPACE: /app/families/openclaw/blaise
      # Anthropic — Claude Opus 4.6 (upgraded 6 fév 2026)
      ANTHROPIC_OAUTH_TOKEN: "${ANTHROPIC_OAUTH_TOKEN:-}"
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY:-}"
      ZEROCLAW_ALLOW_PUBLIC_BIND: "true"
      RUST_LOG: info

  ui:
    build:
      context: ./ui
    ports: ["3050:3000"]
    restart: unless-stopped
    networks: [famille-net]
    environment:
      DEFAULT_BACKEND_URL: "http://gateway:3000/v1"

networks:
  famille-net:
