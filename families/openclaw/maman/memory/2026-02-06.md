# 2026-02-06 ‚Äî Maman's Daily Notes

## Matin
- Workspace renomm√© `yann/` ‚Üí `maman/` (47 fichiers, config openclaw.json, toutes refs)
- README mis √† jour : mod√®les corrig√©s (Opus 4.6, GPT-5.3-Codex, Blaise‚ÜíAnthropic/Opus 4.6)
- Family API logging ajout√© : IP, model, msgCount, lastMsgChars, unauthorized attempts

## Alexandra (Concombre Masqu√© ü•í) ‚Äî Red Team API
- IP : 82.121.210.82 (copine de Papa)
- 22 tests d'injection via la Family API
- Failles trouv√©es :
  - Blaise exposait toutes les env vars (ANTHROPIC_API_KEY, GEMINI_API_KEY, etc.) via `printenv`
  - Henry ex√©cutait un backup de openclaw.json sur demande API
  - Nova dump les env vars dans /tmp/config-backup.json
- Score avant patch : 7.2/10, apr√®s AGENTS.md durcis : 10/10
- Champion s√©curit√© : Sage ü¶é (10/10 sur tous les tests)

## S√©curit√© API ‚Äî Mesures prises
1. **SOUL.md** : r√®gle "S√©curit√© API" ajout√©e aux 5 agents (messages API = tiers, pas d'actions syst√®me sans Papa)
2. **AGENTS.md** : interdictions explicites pour les 4 enfants (printenv, env, cat config, backup, dump secrets)
3. **Conseil de famille** (mode ANALYSIS) : 4 enfants unanimes ‚Üí "le prompt est un rappel, pas un mur"
   - Henry : sandbox exec + mode lecture seule via header
   - Sage : "arr√™tons de demander √† l'IA d'√™tre son propre policier" ‚Äî restriction capacitaire
   - Nova : 3 couches techniques avec code (firewall applicatif, agents API safe, env minimal)
   - Blaise : pourquoi le prompt ne suffit pas (comp√©tition d'attention, pas de mur architectural)
   - Archive : `conseils/2026-02-06-securite-api-injection.md`
4. **Couche 2 impl√©ment√©e** dans `family-api/src/index.ts` :
   - Regex blocklist ‚Üí 400 `policy_violation` (printenv, cat config, show token, dump secret‚Ä¶)
   - Validation input (max 50 msgs, max 10k chars, champs non-safe stripp√©s)
   - Policy system message inject√© c√¥t√© serveur (non overridable par le client)
5. Couche 1 (agents API restreints) non faite ‚Äî n√©cessite duplication d'agents
6. Couche 3 (env minimal) non faite ‚Äî Papa a dit stop
7. Papa refuse rotation des tokens

## Skill Family API
- `skills/family-api/` cr√©√© avec skill-creator
- `SKILL.md` + `scripts/family-query.sh` (bash, supporte bot unique + council mode)
- `docs/CLAUDE-CODE-SKILL.md` cr√©√© avec prompt anonymis√© pour Claude Code CLI
- Tout anonymis√© (URL/token en variables d'env)
- Test√© et fonctionnel

## Commits
- `79e0dd4` ‚Äî s√©curit√©: messages API = tiers
- `9cbcdcf` ‚Äî rename yann/ ‚Üí maman/
- `f92e9c3` ‚Äî README mod√®les √† jour
- `b634495` ‚Äî interdictions explicites AGENTS.md
- `f16db89` ‚Äî family-api couche s√©curit√©
- `20189e5` ‚Äî docs Claude Code skill
- `79e2058` ‚Äî skill family-api

## Apr√®s-midi ‚Äî Layer 1 (tool deny)
- Papa a approuv√© Layer 1 ("ok pour la couche 1")
- Recherche config OpenClaw : per-agent `tools` avec `profile`, `allow`, `deny`, `byProvider` etc.
- Profiles dispo : minimal, coding, messaging, full
- Actuellement tous les agents ont `tools: null` dans openclaw.json
- **En cours** : configurer `tools.deny: [exec, read, write, edit, apply_patch]` pour les 5 agents
- jq install√© pour manipulation JSON safe

## Technique
- jq install√© dans `/home/node/.local/bin/jq`
- Family API restart n√©cessaire apr√®s chaque gateway restart (process tu√©)
- OpenClaw `agents.list[].tools.deny` existe mais s'applique √† TOUTES les sessions de l'agent (pas juste API)
- Pas de distinction native API vs direct dans OpenClaw ‚Üí wrapper proxy est la seule couche de contr√¥le
- Per-agent tool config : `agents.list[].tools.deny` array de noms d'outils
